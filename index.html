<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Map - 事故物件マップ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Zen+Kaku+Gothic+New:wght@300;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Google Maps API: 実際のAPIキーに置き換えてください -->
    <script>
        (g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })({
            key: "AIzaSyCUn5v-4CmefV4NCsRNguW4ta_npyQ00U0",
            v: "weekly",
            libraries: ["places"],
        });
    </script>
</head>

<body>
    <div id="app">
        <header class="glass-header">
            <h1>Ghost Map</h1>
            <p>見えないものが、ここにある。</p>
            <div class="search-container">
                <input id="pac-input" class="controls glass-input" type="text" placeholder="場所を検索...">
            </div>
        </header>

        <div id="map"></div>

        <div id="info-panel" class="glass-panel hidden">
            <button id="close-panel" class="close-btn">&times;</button>
            <h2 id="panel-title">物件詳細</h2>
            <div id="panel-content">
                <!-- 詳細情報がここに表示されます -->
            </div>
        </div>

        <div id="add-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <span class="close-modal">&times;</span>
                <h2>事故物件情報を投稿</h2>
                <form id="incident-form">
                    <div class="form-group">
                        <label for="map-url">Googleマップ共有URL (必須)</label>
                        <input type="url" id="map-url" placeholder="https://maps.app.goo.gl/..." required>
                        <small class="hint">Uberアプリ等の「共有」からURLをコピー</small>
                    </div>

                    <div class="form-group-row">
                        <div class="form-group">
                            <label for="store-name">店名 (自動取得)</label>
                            <input type="text" id="store-name" placeholder="URLから自動取得" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="hazard-type">地雷タイプ</label>
                        <select id="hazard-type" required>
                            <option value="wait">⏳ 調理待ちが長い</option>
                            <option value="location">🗺️ 場所がわかりにくい</option>
                            <option value="attitude">😡 店員の態度が悪い</option>
                            <option value="parking">🚲 駐輪スペースなし</option>
                            <option value="other">💣 その他</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="wait-time">目安待ち時間: <span id="wait-time-val">10分</span></label>
                        <input type="range" id="wait-time" min="0" max="60" step="5" value="10">
                        <div class="range-labels">
                            <span>0分</span>
                            <span>30分</span>
                            <span>60分+</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="photo">証拠写真 (任意)</label>
                        <div class="file-upload-wrapper">
                            <button type="button" id="photo-btn" class="secondary-btn">📷 写真を選択</button>
                            <input type="file" id="photo" accept="image/*" style="display:none">
                            <span id="file-name" class="file-name">選択されていません</span>
                        </div>
                        <div id="preview-area" class="hidden">
                            <img id="photo-preview" src="" alt="プレビュー">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="comment">詳細コメント</label>
                        <textarea id="comment" rows="3" placeholder="「入り口は裏手です」など..."></textarea>
                    </div>

                    <button type="submit" class="submit-btn">地雷を登録する 💣</button>
                    <input type="hidden" id="lat">
                    <input type="hidden" id="lng">
                    <input type="hidden" id="photo-base64">
                </form>
            </div>
        </div>

        <button id="add-mode-btn" class="fab" title="新規投稿モード">
            <span class="icon">+</span>
        </button>
        <div id="toast" class="toast hidden"></div>
    </div>
    <script src="app.js"></script>
</body>

</html>